name: ğŸš€ Build and Release

# Se ejecuta automÃ¡ticamente cuando:
# - Haces push a la rama main
# - Creas un nuevo tag (ej: v1.0.0)
# - O lo ejecutas manualmente desde GitHub
on:
  push:
    branches: [main]
    tags:
      - "v*"
  workflow_dispatch: # Permite ejecuciÃ³n manual

jobs:
  build:
    name: ğŸ”¨ Compilar Ejecutable Windows
    runs-on: windows-latest

    steps:
      - name: ğŸ“¥ Descargar cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ Configurar Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: ğŸ“¦ Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller

      - name: ğŸ”¨ Compilar con PyInstaller
        run: |
          pyinstaller DescargadorMusica.spec

      - name: ğŸ“‹ Verificar ejecutable
        run: |
          if (Test-Path "dist/DescargadorMusica.exe") {
            Write-Host "âœ… Ejecutable creado exitosamente"
            $size = (Get-Item "dist/DescargadorMusica.exe").Length / 1MB
            Write-Host "ğŸ“¦ TamaÃ±o: $([math]::Round($size, 2)) MB"
          } else {
            Write-Host "âŒ Error: No se encontrÃ³ el ejecutable"
            exit 1
          }

      - name: ğŸ“¤ Subir ejecutable como artefacto
        uses: actions/upload-artifact@v4
        with:
          name: DescargadorMusica-Windows
          path: dist/DescargadorMusica.exe
          if-no-files-found: error

      # Este paso solo se ejecuta si haces push de un tag (ej: v1.0.0)
      - name: ğŸ‰ Crear Release en GitHub
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: dist/DescargadorMusica.exe
          draft: false
          prerelease: false
          generate_release_notes: true
          body: |
            ## ğŸµ Descargador de MÃºsica YouTube

            ### â¬‡ï¸ Descarga
            Descarga el archivo `DescargadorMusica.exe` y ejecÃºtalo directamente.

            ### âœ¨ CaracterÃ­sticas
            - Descarga mÃºsica en MP3 (solo audio)
            - Descarga videos en MP4 (video completo)
            - Interfaz simple e intuitiva
            - InstalaciÃ³n automÃ¡tica de FFmpeg

            ### ğŸ“ Cambios en esta versiÃ³n
            Ver detalles abajo â¬‡ï¸
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
